<Window x:Class="DriverDeploy.Server.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="DriverDeploy - Центр управления драйверами" Height="900" Width="1600">
    <DockPanel>
        <!-- Панель управления -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="10" Background="#f0f0f0">
            <Button x:Name="ScanButton" Content="🔍 Сканировать сеть" 
                    Click="ScanButton_Click" Margin="5" Padding="15,8" FontWeight="Bold"/>
            <Button x:Name="ScanDevicesButton" Content="🧭 Сканировать устройства" 
                    Click="ScanDevicesButton_Click" Margin="5" Padding="15,8" Background="LightBlue"/>
            <Button x:Name="UpdateDriversButton" Content="🎯 Автообновление драйверов" 
                    Click="UpdateDrivers_Click" Margin="5" Padding="15,8" Background="#4CAF50" Foreground="White" FontWeight="Bold"/>
            <Button x:Name="UpdateAllMachinesButton" Content="🌐 Обновить все машины" 
                    Click="UpdateAllMachinesButton_Click" Margin="5" Padding="15,8" Background="#2196F3" Foreground="White" FontWeight="Bold"/>
            <Button x:Name="RefreshRepoButton" Content="🔄 Обновить базу драйверов" 
                    Click="RefreshRepoButton_Click" Margin="5" Padding="15,8" Background="Orange"/>
        </StackPanel>

        <!-- Основной контент -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="300"/>
            </Grid.ColumnDefinitions>

            <!-- Список найденных машин и их драйверов -->
            <TabControl Grid.Column="0" Margin="10">
                <TabItem Header="🖥️ Машины в сети">
                    <ListView x:Name="MachinesListView" Margin="5" SelectionChanged="MachinesListView_SelectionChanged">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Имя компьютера" DisplayMemberBinding="{Binding MachineName}" Width="200"/>
                                <GridViewColumn Header="IP адрес" DisplayMemberBinding="{Binding IpAddress}" Width="120"/>
                                <GridViewColumn Header="Статус" DisplayMemberBinding="{Binding Status}" Width="100"/>
                                <GridViewColumn Header="ОС" DisplayMemberBinding="{Binding OSVersion}" Width="150"/>
                                <GridViewColumn Header="Драйверы" DisplayMemberBinding="{Binding InstalledDrivers.Count}" Width="80"/>
                                <GridViewColumn Header="Обновления" DisplayMemberBinding="{Binding OutdatedDrivers.Count}" Width="100"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </TabItem>

                <TabItem Header="🔌 Устройства машины">
                    <ListView x:Name="DevicesListView" Margin="5">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Категория" DisplayMemberBinding="{Binding Category}" Width="120"/>
                                <GridViewColumn Header="Устройство" DisplayMemberBinding="{Binding Name}" Width="250"/>
                                <GridViewColumn Header="Производитель" DisplayMemberBinding="{Binding Manufacturer}" Width="120"/>
                                <GridViewColumn Header="Версия драйвера" DisplayMemberBinding="{Binding DriverVersion}" Width="120"/>
                                <GridViewColumn Header="Статус" Width="120">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock>
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Text" Value="✅ Актуальный"/>
                                                        <Setter Property="Foreground" Value="Green"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding DriverVersion}" Value="">
                                                                <Setter Property="Text" Value="❌ Нет драйвера"/>
                                                                <Setter Property="Foreground" Value="Red"/>
                                                                <Setter Property="FontWeight" Value="Bold"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding DriverVersion}" Value="Unknown">
                                                                <Setter Property="Text" Value="❌ Нет драйвера"/>
                                                                <Setter Property="Foreground" Value="Red"/>
                                                                <Setter Property="FontWeight" Value="Bold"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </TabItem>

                <TabItem Header="📦 Драйверы машины">
                    <ListView x:Name="DriversListView" Margin="5">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Устройство" DisplayMemberBinding="{Binding DeviceName}" Width="250"/>
                                <GridViewColumn Header="Версия" DisplayMemberBinding="{Binding DriverVersion}" Width="120"/>
                                <GridViewColumn Header="Поставщик" DisplayMemberBinding="{Binding Provider}" Width="150"/>
                                <GridViewColumn Header="Статус" Width="100">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock>
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding NeedsUpdate}" Value="True">
                                                                <Setter Property="Text" Value="🔄 Требует обновления"/>
                                                                <Setter Property="Foreground" Value="Orange"/>
                                                                <Setter Property="FontWeight" Value="Bold"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding NeedsUpdate}" Value="False">
                                                                <Setter Property="Text" Value="✅ Актуальный"/>
                                                                <Setter Property="Foreground" Value="Green"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </TabItem>
            </TabControl>

            <!-- Панель управления драйверами -->
            <StackPanel Grid.Column="1" Margin="10" Background="#f8f8f8">
                <GroupBox Header="🎯 Управление драйверами" Margin="5">
                    <StackPanel>
                        <TextBlock Text="Выбранная машина:" FontWeight="Bold" Margin="0,5"/>
                        <TextBlock x:Name="SelectedMachineText" Text="Не выбрана" Margin="0,5" Foreground="Blue"/>

                        <Button x:Name="RefreshDriversButton" Content="🔄 Обновить список драйверов" 
                                Click="RefreshDriversButton_Click" Margin="0,10" Padding="10,5"/>

                        <Button x:Name="CheckUpdatesButton" Content="🔍 Проверить обновления" 
                                Click="CheckUpdatesButton_Click" Margin="0,5" Padding="10,5" Background="LightYellow"/>

                        <ProgressBar x:Name="ScanProgress" Width="200" Height="20" Margin="10,0" 
                                     Visibility="Collapsed" IsIndeterminate="True"/>
                    </StackPanel>
                </GroupBox>

                <GroupBox Header="📊 Статус системы" Margin="5">
                    <StackPanel>
                        <TextBlock x:Name="RepoStatusText" Text="База драйверов: ❌ Не загружена" Margin="5"/>
                        <TextBlock x:Name="MachinesStatusText" Text="Найдено машин: 0" Margin="5"/>
                        <TextBlock x:Name="DevicesStatusText" Text="Устройств: 0" Margin="5"/>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </Grid>

        <!-- Панель результатов -->
        <Border DockPanel.Dock="Bottom" Background="#f8f8f8" BorderThickness="1" BorderBrush="#ddd" Margin="10" Padding="10" Height="100">
            <ScrollViewer>
                <TextBlock x:Name="ResultText" Text="Готов к работе. Нажмите 'Обновить базу драйверов' для начала." TextWrapping="Wrap"/>
            </ScrollViewer>
        </Border>
    </DockPanel>
</Window>